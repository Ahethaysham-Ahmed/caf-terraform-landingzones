kind: containerapp
location: australiaeast
name: rover-platform
resourceGroup: a20-rg-gitops-agents-wpo
type: Microsoft.App/containerApps
properties:
  managedEnvironmentId: /subscriptions/558a029f-aba1-47ff-b620-1d01350e2dd5/resourceGroups/a20-rg-gitops-agents-wpo/providers/Microsoft.App/managedEnvironments/rover-platform-landingzones
  configuration:
    activeRevisionsMode: single
    secrets:
      - name: queue-conn-string
        value: DefaultEndpointsProtocol=https;EndpointSuffix=core.windows.net;AccountName=a20stkedaplzhlr;AccountKey=VJhyRKo71k/rp5rMPm8y2bunf1CfFrzflSJuU7Rb7zKr/A6Aie1QDMEygZjW9XLWkDWqGG3R7dH9+ASt2q0/tw==;BlobEndpoint=https://a20stkedaplzhlr.blob.core.windows.net/;FileEndpoint=https://a20stkedaplzhlr.file.core.windows.net/;QueueEndpoint=https://a20stkedaplzhlr.queue.core.windows.net/;TableEndpoint=https://a20stkedaplzhlr.table.core.windows.net/
      - name: gh-token
        value: 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
      - name: acr-password
        value: OmGLIdn21FksEC06gxqhOGwxQMm+CtH1
    ingress:
      allowInsecure: false
      external: false
      targetPort: 1234
    registries:
      - server: a20crplatformlpq.azurecr.io
        username: a20crplatformlpq
        passwordSecretRef: acr-password
  template:
    revisionSuffix: 16
    containers:
      - image: a20crplatformlpq.azurecr.io/caf/rover-agent:1.2.7-2208.230606-preview-github
        name: rover-runner
        env:
          - name: EPHEMERAL
            value: "true"
          - name: GH_OWNER
            value: LaurentLesle
          - name: GH_REPOSITORY
            value: a20
          - name: GH_TOKEN
            secretRef: gh-token
          - name: LABELS
            value: platform
          - name: URL
            value: https://github.com/LaurentLesle/a20
          - name: USERNAME
            value: vscode
        resources:
          cpu: 2
          memory: 4Gi
    scale:
      minReplicas: 0
      maxReplicas: 30
      rules:
        - name: auto-scale
          custom:
            type: azure-queue
            auth:
              - secretRef: queue-conn-string
                triggerParameter: connection
            metadata:
              queueLength: 1
              queueName: caf-terraform-platform-landgingzones
              accountName: a20stkedaplzhlr
