storage_accounts = {
{% for key, value in resources.subscriptions[subscription_key].storage_accounts.items() %}
  {{ key }} = {
    name                      = "{{ value.name }}"
    resource_group_key        = "{{ value.resource_group_key }}"
    account_kind              = "{{ value.account_kind | default('BlobStorage') }}"
    account_tier              = "{{ value.account_tier | default('Standard') }}"
    shared_access_key_enabled = {{ value.shared_access_key_enabled | lower | default('false') }}
    account_replication_type  = "{{ value.account_replication_type }}"
{% if value.access_tier is defined %}
    access_tier               = "{{ value.access_tier }}"
{% endif %}
{% if value.min_tls_version is defined %}
    min_tls_version           = "{{ value.min_tls_version }}"
{% endif %}
{% if value.allow_blob_public_access is defined %}
    allow_blob_public_access  = {{ value.allow_blob_public_access | lower }}
{% endif %}
{% if value.is_hns_enabled is defined %}
    is_hns_enabled            = {{ value.is_hns_enabled | lower }}
{% endif %}
{% if value.nfsv3_enabled is defined %}
    nfsv3_enabled             = {{ value.nfsv3_enabled | lower }}
{% endif %}
{% if value.large_file_share_enabled is defined %}
    large_file_share_enabled  = {{ value.large_file_share_enabled | lower }}
{% endif %}
{% if value.enable_system_msi is defined %}
    enable_system_msi         = {{ value.enable_system_msi | lower }}
{% endif %}
    
{% if value.blob_properties is defined %}
    blob_properties = {
{% if value.blob_properties.versioning_enabled is defined %}
      versioning_enabled                = {{ value.blob_properties.versioning_enabled | lower }}
{% endif %}
{% if value.blob_properties.change_feed_enabled is defined %}
      change_feed_enabled               = {{ value.blob_properties.change_feed_enabled | lower }}
{% endif %}
{% if value.blob_properties.last_access_time_enabled is defined %}
      last_access_time_enabled          = {{ value.blob_properties.last_access_time_enabled | lower }}
{% endif %}
{% if value.blob_properties.default_service_version is defined %}
      default_service_version           = "{{ value.blob_properties.default_service_version }}"
{% endif %}
{% if value.blob_properties.container_delete_retention_policy is defined %}
      container_delete_retention_policy = {
        days = {{ value.blob_properties.container_delete_retention_policy.days }}
      }
{% endif %}
{% if value.blob_properties.delete_retention_policy is defined %}
      delete_retention_policy = {
        days = {{ value.blob_properties.delete_retention_policy.days }}
      }
{% endif %}
    }
{% endif %}

{% if value.network is defined %}
    network = {
{% if value.network.default_action is defined %}
      default_action = {{ value.network.default_action | lower }}
{% endif %}
{% if value.network.bypass is defined %}
      bypass = {{ value.network.bypass | replace('None','[]') | replace('\'','\"') }}
{% endif %}
{% if value.network.ip_rules is defined %}
      ip_rules = {{ value.network.ip_rules | replace('None','[]') | replace('\'','\"') }}
{% endif %}
{% if value.network.subnets is defined %}
      subnets = {
{% for s_key, s_value in value.network.subnets.items() %}
        {{ s_key }} = {
{% if s_value.remote_subnet_id is defined %}
          remote_subnet_id = "{{ s_value.remote_subnet_id  }}"
{% else %}
{% if s_value.lz_key is defined %}
          lz_key     = "{{ s_value.lz_key }}"
{% endif %}
          vnet_key   = "{{ s_value.vnet_key }}"
          subnet_key = "{{ s_value.subnet_key }}"
{% endif %}
        }
{% endfor %}
      }
{% endif %}
    }
{% endif %}

{% if value.containers is defined %}
    containers = {
{% for c_key, c_value in value.containers.items() %}
      {{ c_key }} = {
        name = "{{ c_value.name }}"
      }
{% endfor %}
    }
{% endif %}

{% if value.tags is defined %}
    tags   = {
{% for tag_key, tag_value in value.tags.items() %}
      {{ tag_key }} = "{{ tag_value }}"
{% endfor %}
    }
{% endif %}
  }
  
{% endfor %}
}