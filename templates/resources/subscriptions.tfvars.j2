#
# Execute the following command to get the billing_account_name and management_group_id
#
# az rest --method get --uri https://management.azure.com/providers/Microsoft.Billing/billingaccounts/?api-version=2020-05-01
#
# To retrieve the first billing account
#
# billing_account_name=$(az rest --method get --uri https://management.azure.com/providers/Microsoft.Billing/billingaccounts?api-version=2020-05-01 --query "value[?properties.agreementType=='EnterpriseAgreement'].{name:name}" -o tsv)
#
# enrollment_account_name=$(az rest --method get --uri https://management.azure.com/providers/Microsoft.Billing/billingaccounts?api-version=2020-05-01 --query "value[?properties.agreementType=='EnterpriseAgreement'].{name:properties.enrollmentAccounts[0].name}" -o tsv)
#

subscriptions = {
{% if deployments[lz_type]['scale_out_domains'] is defined %}
{%  for app_key, app_value in resources[tfstate_resource].resources[subscription_key].subscriptions.items() %}
{%    for scod_key, value in app_value.items() %}
{%      set key = app_key + '_' + scod_key %}
{%      include 'subscriptions_tpl.j2' %}
{%    endfor %}
{%  endfor %}
{% else %}
{%  for key, value in resources[tfstate_resource].resources[subscription_key].subscriptions.items() %}
{%    include 'subscriptions_tpl.j2' %}
{%  endfor %}
{% endif %}

}