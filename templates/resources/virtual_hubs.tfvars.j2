virtual_hubs = {
{% for key, value in resources.subscriptions[subscription_key].virtual_hubs.items() %}
  {{ key }} = {
    virtual_wan = {
{% if value.virtual_wan.lz_key is defined %}
      lz_key = "{{ value.virtual_wan.lz_key }}"
{% endif %}
      key    = "{{ value.virtual_wan.key }}"
    }

    resource_group = {
{% if value.virtual_wan.lz_key is defined %}
      lz_key = "{{ value.virtual_wan.lz_key }}"
{% endif %}
      key = "{{ value.virtual_wan.key }}"
    }

    hub_name           = "{{ value.name }}"
{% if value.region_key is defined %}
    region             = "{{ value.region_key }}"
{% endif %}
    hub_address_prefix = "{{ value.hub_address_prefix }}"

{% if value.routes is defined %}
    routes = {
{% for rt_key, rt_value in value.routes.items() %}
      {{rt_key}} = {
        address_prefixes = {{ rt_value.address_prefixes | replace('None','[]') | replace('\'','\"') }}
        next_hop_ip_address = "{{ rt_value.next_hop_ip_address }}"
      }
{% endfor %}
    }
{% endif %}

{% if value.deploy_p2s is defined %}
    deploy_p2s    = {{ value.deploy_p2s | lower }}
{% endif %}
{% if value.p2s_config is defined %}
    p2s_config = {
        name = "{{ value.p2s_config.name }}"
        scale_unit = "{{ value.p2s_config.scale_unit }}"
{% if value.p2s_config.connection_configuration is defined %}
        connection_configuration = {
          name = "{{ value.p2s_config.connection_configuration.name }}"
{% if value.p2s_config.connection_configuration.vpn_client_address_pool is defined %}
          vpn_client_address_pool = {
{% for cap_key, cap_value in value.p2s_config.connection_configuration.vpn_client_address_pool.items() %}
            {{cap_key}} = {
              address_prefixes = {{cap_value | replace('None','[]') | replace('\'','\"') }}
            }
{% endfor %}
          }
{% endif %}
        }
{% endif %}
    }
{% endif %}

{% if connectivity_virtual_hub.virtual_hubs[virtual_hub].deploy_s2s  %}
    deploy_s2s         = {{ connectivity_virtual_hub.virtual_hubs[virtual_hub].deploy_s2s | string | lower }}
    s2s_config         = {
      name       = "{{ connectivity_virtual_hub.virtual_hubs[virtual_hub].s2s_config.name }}"
      scale_unit = {{ connectivity_virtual_hub.virtual_hubs[virtual_hub].s2s_config.scale_unit }}
    }
{% else %}
    deploy_s2s         = false
{% endif %}
{% if connectivity_virtual_hub.virtual_hubs[virtual_hub].deploy_er  %}
    deploy_er          = {{ connectivity_virtual_hub.virtual_hubs[virtual_hub].deploy_er | string | lower }}
    er_config          = {
      name        = "{{ connectivity_virtual_hub.virtual_hubs[virtual_hub].er_config.name }}"
      scale_units = {{ connectivity_virtual_hub.virtual_hubs[virtual_hub].er_config.scale_units }}
    }
{% else %}
    deploy_er          = false
{% endif %}

{% if value.security_partner_provider is defined %}
    security_partner_provider = {
{% for spp_key, spp_value in value.security_partner_provider.items() %}
      {{spp_key}} = {
        name = "{{ spp_value.name }}"
        security_provider_name = "{{ spp_value.security_provider_name }}"
      }
{% endfor %}
    }
{% endif %}

{% if value.bgp_connection is defined %}
    bgp_connection = {
{% for bgp_key, bgp_value in value.bgp_connection.items() %}
      {{bgp_key}} = {
        name = "{{ bgp_value.name }}"
        peer_asn = "{{ bgp_value.peer_asn }}"
        peer_ip = "{{ bgp_value.peer_ip }}"
      }
{% endfor %}
    }
{% endif %}

  }
{% endfor %}
}
