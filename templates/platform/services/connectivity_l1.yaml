connectivity:
  gitops:
    caf_landingzone_branch: {{caf_landingzone_branch}}

  relative_destination_folder: level1/connectivity

  tfstate:
    lz_key_name: connectivity_l1
    tfstate: connectivity.tfstate
    level: level1
    identity_aad_key: cred_connectivity
    config_file: connectivity_l1.yaml
    # Do not rename the tfstate_key_name
    tfstate_key_name: connectivity

  deployments:
    landingzone:
      global_settings_key:
        platform:
          launchpad:
      remote_tfstates:
        platform:
          launchpad:

  resources:
    connectivity:
      resource_groups:
        management:
          name: management
        alerts:
          name: alerts
        dns_connectivity_prod:
          name: connectivity-dns-prod

      monitor_action_groups:
        connectivity_operations:
          action_group_name: Connectivity Operations
          resource_group_key: alerts
          shortname: conops
          arm_role_alert:
            reader:
              name: Monitoring Reader
              role_name: Monitoring Reader
              use_common_alert_schema: false
          email_receiver:
            noc:
              name: email_alert_support1
              email_address: {{topology.notifications.service_health_alerts}}
              use_common_alert_schema: false

      service_health_alerts:
        enable_service_health_alerts: true
        name: alerts
        shortname: HealthAlerts
        resource_group_key: alerts
        action_group_name: actiongrp
        email_alert_settings:
          support1:
            name: email_alert_support1
            email_address: {{topology.notifications.service_health_alerts}}
            use_common_alert_schema: false

      recovery_vaults:
        asr:
          name: asr
          resource_group_key: management
          soft_delete_enabled: true
          backup_policies:
            {{topology.backup_policies | to_nice_yaml(width=80, indent=2) | indent(12)}}

      private_dns:
{% for key in variables.variables_private_dns_zones.zones.keys() %}
        {{key}}:
          name: {{key}}
          resource_group_key: dns_connectivity_prod
          vnet_links:
            # fw_{{env}}_01:
            #   name: fw-{{env}}-01
            #   vnet_key: vnet
            #   lz_key: connectivity_private_dns_firewalls_{{env}}
            gitops:
              name: gitops
              vnet_key: vnet_region1
              lz_key: launchpad
{% if lookup('env', 'bootstrap_vnet_id') is defined %}
            bootstrap:
              name: bootstrap
              virtual_network_id: {{ lookup('env', 'bootstrap_vnet_id') }}
{% endif %}
{% endfor %}
{% for region in topology.resources_allowed_regions %}
{% for z_key in variables.variables_private_dns_zones.regional_zones %}
        {{z_key | replace('region', region)}}:
          name: {{z_key | replace('region', region)}}
          resource_group_key: dns_connectivity_prod
          vnet_links:
            # fw_{{env}}_01:
            #   name: fw-{{env}}-01
            #   vnet_key: vnet
            #   lz_key: connectivity_private_dns_firewalls_{{env}}
            gitops:
              name: gitops
              vnet_key: vnet_region1
              lz_key: launchpad
{% if lookup('env', 'bootstrap_vnet_id') is defined %}
            bootstrap:
              name: bootstrap
              virtual_network_id: {{ lookup('env', 'bootstrap_vnet_id') }}
{% endif %}
{% endfor %}
{% endfor %}